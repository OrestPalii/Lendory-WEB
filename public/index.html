<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lendory</title>
  <link rel="stylesheet" href="style.css">
  <style>
    label{display: inline-block; width:80px}
    input,select{width: 120px;}
  </style>
  <script src="adv.js"></script>
</head>
<body>
<!--------------------------------------------------Parametrs of advertisement---------->
  <label>Area</label> <input id="areabox" type="number"><br><br>
  <label>Currency</label>
  <select id="Curbox">
    <option value="₴"></option>
    <option value="$"></option>
    <option value="€"></option>
    <option value="£"></option>
  </select><br><br>
 <label>Description</label><input id='descripbox' type="text"><br><br>
 <label>Floor</label><input id='floorNumbox' type="number"><br><br>
 <label>Location</label><input id='locbox' type="text"><br><br>
 <label>Name</label><input id='nameStbox' type="text"><br><br>
 <label>Number of rooms</label><input id="numofRoomsbox" type="number"><br><br>
 <label>Price</label><input id="pricebox" type="number"><br><br>
 <label>Volunteering</label>
 <select id="volbox">
  <option value="true"></option>
  <option value="false"></option>
</select><br><br>
<label>Name</label><input id='creatnamebox' type="text"><br><br>
<label>Phonenumber</label><input id='phonebox' type="text"><br><br>
<!--<label>Advertisement number</label><input id="numOfadvbox" type="number"><br><br>-->

  
 <hr>

 <button id="Insbtn">Insert</button>
 <button id="Selbtn">Select</button>
 <button id="Updbtn">Update</button>
 <button id="Delbtn">Delete</button><br><br><br><br>
<img id="myimg1">
<img id="myimg2">
<img id="myimg3">
<img id="myimg4">
<img id="myimg5"><br>
<button id="selbtn1">Select Image</button>
<button id="selbtn2">Select Image</button>
<button id="selbtn3">Select Image</button>
<button id="selbtn4">Select Image</button>
<button id="selbtn5">Select Image</button>

<!--------------------------------------------------JavaScript functions and libraries---------->
<script scr="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
<script scr="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
<script scr="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
<script scr="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js"></script>

 <script type="module">
  // ------------------------------Importing the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  // -------------------------------- web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCPf1_9AlKYGFEF0nHn3c1IGH8BecVSeig",
    authDomain: "lendory-b5d8b.firebaseapp.com",
    databaseURL: "https://lendory-b5d8b-default-rtdb.firebaseio.com",
    projectId: "lendory-b5d8b",
    storageBucket: "lendory-b5d8b.appspot.com",
    messagingSenderId: "759222136421",
    appId: "1:759222136421:web:8c38d800bca06e1e6ce08c"
  };
  // --------------------------------------------Initializing Firebase
  const app = initializeApp(firebaseConfig);
  import {getDatabase, ref, get, set, child, update, remove}
  from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"
  import {getStorage, ref as sRef, uploadBytesResumable, getDownloadURL} 
            from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js"
  const db = getDatabase();
  
  //-------------------------------------------Variables
  var area = document.getElementById("areabox");
  var curbox = document.getElementById("Curbox")
  var description = document.getElementById("descripbox");
  var floor = document.getElementById("floorNumbox");
  var location = document.getElementById("locbox");
  var name = document.getElementById("nameStbox");
  var numofrooms = document.getElementById("numofRoomsbox");
  var price = document.getElementById("pricebox");
  var volunteering = document.getElementById("volbox");
  var creatname = document.getElementById("creatnamebox");
  var phonenumber = document.getElementById("phonebox");
  var numOfadv = document.getElementById('numOfadvbox')
  

  var insBtn = document.getElementById("Insbtn");
  var selBtn = document.getElementById("Selbtn");
  var updBtn = document.getElementById("Updbtn");
  var delBtn = document.getElementById("Delbtn");
  var advnum;

  
  let adv = new Advertisement(0, "₴", "lorem", 0, "lorem", "lorem", 0, 0, false, "Lorem", 0);

  //-----------------------------------------------------functions
  function InsertData(){
    advnum = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
    adv.setarea(areabox.value);
    adv.setcurrency(Curbox.value);
    adv.setdescription(descripbox.value);
    adv.setfloor(floorNumbox.value);
    adv.setlocation(locbox.value);
    adv.setname(nameStbox.value);
    adv.setnumberOfRooms(numofRoomsbox.value);
    adv.setprice(pricebox.value);
    adv.setvolunteering(volbox.value);
    
    set(ref(db, "advertisement/"+ advnum),{
        area: parseInt(adv.getarea()),
        currency: adv.getcurrency(),
        description: adv.getdescription(),
        floor: parseInt(adv.getfloor()),
        location: adv.getlocation(),
        name: adv.getname(),
        numberOfRooms: parseInt(adv.getnumberOfRooms()),
        price: parseInt(adv.getprice()),

        volunteering: Boolean(adv.getvolunteering())  
    })
    .then(()=>{
      alert("Data stored succesfully");
      adv.setcrname(creatnamebox.value);
      adv.setphoneNumber(phonebox.value); 
      set(ref(db, "advertisement/"+ advnum  + "/creator/"),{
      name: adv.getcrname(),
      phoneNumber: adv.getphoneNumber()
    })
  })
  .catch((error)=>{
    alert("unsuccessful, error"+error)
  });
}

function SelectData(){
  
  const dbref = ref(db);
  get(child(dbref, "advertisement/52831441/")).then((snapshot)=>{
      if(snapshot.exists()){
        adv.setarea(snapshot.val().area);
        adv.setcurrency(snapshot.val().currency);
        adv.setdescription(snapshot.val().description);
        adv.setfloor(snapshot.val().floor);
        adv.setlocation(snapshot.val().location);
        adv.setname(snapshot.val().name);
        adv.setnumberOfRooms(snapshot.val().numberOfRooms);
        adv.setprice(snapshot.val().price);
        adv.setvolunteering(snapshot.val().volunteering);

        areabox.value = adv.getarea(),
        Curbox.value =  adv.getcurrency(),
        descripbox.value = adv.getdescription(),
        floorNumbox.value =  adv.getfloor(),
        locbox.value = adv.getlocation(),
        nameStbox.value = adv.getname(),
        numofRoomsbox.value = adv.getnumberOfRooms(),
        pricebox.value = adv.getprice(),
        volbox.value = adv.getvolunteering();

        get(child(dbref, "advertisement/52831441/creator/")).then((snapshot)=>{
          adv.setcrname(snapshot.val().name);
          adv.setphoneNumber(snapshot.val().phoneNumber);
          creatnamebox.value = adv.getcrname(),
          phonebox.value = adv.getphoneNumber()
        })
      }
      else{
        alert("No data found");
      }
  }).catch((error)=>{
    alert("unsuccessful, error"+error);
  });
}

function UpdateData(){
  update(ref(db, "advertisement/"+ numOfadvbox.value),{
        area: parseInt(areabox.value),
        currency: curbox.value,
        description: descripbox.value,
        floor: parseInt(floorNumbox.value),
        location: locbox.value,
        name: nameStbox.value,
        numberOfRooms: parseInt(numofRoomsbox.value),
        price: parseInt(pricebox.value),
        volunteering: Boolean(volbox.value)
    })
    .then(()=>{
      alert("Data update succesfully"); 
      update(ref(db, "advertisement/"+ numOfadvbox.value  + "/creator/"),{
      name: creatnamebox.value,
      phoneNumber: phonebox.value
    })
  })
  .catch((error)=>{
    alert("unsuccessful, error"+error)
  });
}
function DeleteData(){
  remove(ref(db, "advertisement/"+ numOfadvbox.value))
    .then(()=>{
      alert("Data removed succesfully"); 
      
  })
  .catch((error)=>{
    alert("unsuccessful, error"+error)
  });
}

insBtn.addEventListener('click', InsertData);
selBtn.addEventListener('click', SelectData); 
updBtn.addEventListener('click', UpdateData);
delBtn.addEventListener('click', DeleteData);
</script>

</body>
</html>