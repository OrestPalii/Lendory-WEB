<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image</title>
   <link rel="stylesheet" href="style.css">
   <script src="test.js"></script>
</head>
<body>
    <!-- <label>Image name</label><input type="text" id="namebox"><label id="extlab"></label><br><br> -->
        <img id="myimg1" src="trans.png"> <br><br>
        <button id="selbtn1">Select Image</button><br><br>
        <img id="myimg2" src="trans.png"> <br><br>
        <button id="selbtn2" >Select Image</button><br><br>
        <img id="myimg3" src="trans.png"> <br><br>
        <button id="selbtn3">Select Image</button><br><br>
        <img id="myimg4" src="trans.png"> <br><br>
        <button id="selbtn4">Select Image</button><br><br>
        <img id="myimg5" src="trans.png"> <br><br>
        <button id="selbtn5">Select Image</button><br><br>

        <button id="upbtn">Upload Image</button>
        <!-- <button id="downbtn" >Retrieve Image</button> -->

        <script type="module">
         
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
           
            const firebaseConfig = {
              apiKey: "AIzaSyCPf1_9AlKYGFEF0nHn3c1IGH8BecVSeig",
              authDomain: "lendory-b5d8b.firebaseapp.com",
              databaseURL: "https://lendory-b5d8b-default-rtdb.firebaseio.com",
              projectId: "lendory-b5d8b",
              storageBucket: "lendory-b5d8b.appspot.com",
              messagingSenderId: "759222136421",
              appId: "1:759222136421:web:8c38d800bca06e1e6ce08c"
            };
          
            const app = initializeApp(firebaseConfig);
            
            import {getDatabase, ref, get, set, child, update, remove}
            from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"
            import {getStorage, ref as sRef, uploadBytesResumable, getDownloadURL} 
            from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js"
            const db = getDatabase();
            var files1 = [];
            var files2 = [];
            var reader1 = new FileReader();
            var reader2 = new FileReader();
            let imgtest = new Images(["a"]);
            imgtest.imgarray.pop();
            
            var myimg1 = document.getElementById("myimg1");
            var SelBtn1 = document.getElementById("selbtn1");

            var myimg2 = document.getElementById("myimg2");
            var SelBtn2 = document.getElementById("selbtn2");

            var myimg3 = document.getElementById("myimg3");
            var SelBtn3 = document.getElementById("sel1btn3");

            var myimg4 = document.getElementById("myimg4");
            var SelBtn4 = document.getElementById("sel1btn4");

            var myimg5 = document.getElementById("myimg5");
            var SelBtn5 = document.getElementById("sel1btn5");

            var UpBtn = document.getElementById("upbtn");
            

            var input1 = document.createElement('input');
            input1.type = 'file';
            var input2 = document.createElement('input');
            input2.type = 'file';

            input1.onchange = e =>{
                files1 = e.target.files;
                reader1.readAsDataURL(files1[0]);
                
            }

            reader1.onload = function(){
                myimg1.src = reader1.result;    
            }
                
            SelBtn1.onclick = function(){
                input1.click();
            }
//-----------------
            input2.onchange = e =>{
                files2 = e.target.files;
                reader2.readAsDataURL(files2[0]);
            }

            reader2.onload = function(){
                myimg2.src = reader2.result;    
            }

            SelBtn2.onclick = function(){
                input2.click();
            }

            async function UploadProcess(){
                var ImgToUpload1 = files1[0];
                var ImgToUpload2 = files2[0];

                var ImgName1 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
                var ImgName2 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
                var ImgName3 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
                var ImgName4 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
                var ImgName5 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
                
                imgtest.imgarray.push(ImgName1);
                imgtest.imgarray.push(ImgName2);
                imgtest.imgarray.push(ImgName3);
                imgtest.imgarray.push(ImgName4);
                imgtest.imgarray.push(ImgName5);
                
                
                set(ref(db, "advertisementtest/Image/"),{
                    0: imgtest.imgarray[0],
                    1: imgtest.imgarray[1],
                    2: imgtest.imgarray[2],
                    3: imgtest.imgarray[3],
                    4: imgtest.imgarray[4]

                })
                .then(()=>{
                
            })
            .catch((error)=>{
                alert("unsuccessful, error"+error)
            });
                const storage = getStorage();
                const storageRef1 = sRef(storage, "Images/"+ImgName1);  
                const storageRef2 = sRef(storage, "Images/"+ImgName2);          
                const metaData1 = {
                    contentType: ImgToUpload1.type
                }
                const metaData2 = {
                    contentType: ImgToUpload2.type
                }
                const UploadTask1 = uploadBytesResumable(storageRef1, ImgToUpload1, metaData1);
                const UploadTask2 = uploadBytesResumable(storageRef2, ImgToUpload2, metaData2);
                /*UploadTask.on('state-changed', (snapshot)=>{
                    var progess = (snapshot.bytesTransferred / snapshot.totalBytes)*100;
                      
                },
                    (error)=>{
                        alert("error: image not uploaded!");
                    }
                );*/
                
                        
            }
            UpBtn.onclick = UploadProcess;

            

          </script>
</body>
</html>