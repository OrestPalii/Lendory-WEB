<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADVERT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!--firebase-->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
    <script scr="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/live/3.1/firebase.js"></script>

    <!--bootsrap-->
    <link href="https://fonts.googleapis.com/css?family=Yeon+Sung&display=swap" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="sign_in_out_logic.js"></script>
    <script src="serverlogic.js"></script>
</head>
<body id="advert">
    <header class="header">
        <div class="header_inner">
            <a href="index.html">
                <img class="header_logo"src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/logo.svg?alt=media&token=a9fbf102-4b28-46d6-bb6d-9469be5a4cc7" alt="">                    
             </a>
                        <nav class="nav">
                            <a href="about.html"> <img src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/AboutUs.png?alt=media&token=a62d422a-1be4-4ca9-9dd4-810e39cb1c1b" alt=""> Про нас</a>
                            <a href="Services.html"> <img src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/services.png?alt=media&token=e0da6157-7b8a-41bf-80dd-b03d8baa75fe" alt=""> Підтримка</a>
                            <a href="advert.html"> <img src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/document-free-icon-font%201.png?alt=media&token=a05f066e-4bea-4bf8-b798-e7affff9eb31" alt=""> Оголошення</a>
                            <a id='userlink' href="profile.html"><img src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/user-free-icon-font%20(1)%201.png?alt=media&token=c967e8f1-bb4f-4092-b242-70654ee0e544" alt=""> Мій профіль </a>
                            <a id="signoutlink" href="#"> <img src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/sign-in-alt-free-icon-font%202.png?alt=media&token=37d4a899-06eb-418d-8bb0-f4d9a9a34681" alt=""> Вийти</a>
                        </nav>
        </div>
    </header>
   
    <section class="addpphoto">
                <div>
                    <h2 class="title" id="pic">Додати фотографії</h2>
                    <img id="second" class="_photo"src= "https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/IMG_20220412_152832_497-06.jpeg?alt=media&token=62dc1fd5-2e55-483e-8138-bd25ab7c810a"
                         alt="" onclick="second_img_upload()" >
                    <img id="third" class="_photo" src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/IMG_20220412_152832_497-06.jpeg?alt=media&token=62dc1fd5-2e55-483e-8138-bd25ab7c810a"
                         alt="" onclick="third_img_upload()">
                    <img id="fourth" class="_photo" src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/IMG_20220412_152832_497-06.jpeg?alt=media&token=62dc1fd5-2e55-483e-8138-bd25ab7c810a"
                         alt="" onclick="fourth_img_upload()">
                    <img id="fifth" class="_photo" src="https://firebasestorage.googleapis.com/v0/b/lendory-b5d8b.appspot.com/o/IMG_20220412_152832_497-06.jpeg?alt=media&token=62dc1fd5-2e55-483e-8138-bd25ab7c810a"
                        alt="" onclick="fifth_img_upload()">
                </div>
                    <div class="description_box">
                        <h2 class="title" >Додаткова інформація</h2>
                        <textarea name="" id="description_box" maxlength="500" cols="40" rows="5" placeholder="Additional information"></textarea>
                        <button class="create" id="create">Cтворити</button> 
                    </div>  
                    
    </section>
  
        <section class="advert_">    
                <h2 class="title" >Назва oголошення</h2>
                <input type="text" name="name" id="name_box" maxlength="70" placeholder="Назва..." >
                    <h2 class="title"  >Місто,вулиця,номер будинка</h2>
                    <input type="text" name="name" id="location_box" maxlength="70" placeholder="Розташування...">               
                            <h2 class="title" >Поверх, к-сть кімнат</h2>                       
                             <input type="number" name="name" min="0" max="1000" id="floor_box"  placeholder="Поверх...">
                             <input type="number" name="name" min="0" max="100"  id="rooms_box"  placeholder="Кількіть кімнат..."> 
                                <h2 class="title" >Загальна площа (кв.м)</h2>                           
                                <input type="number" min="0" max="10000" name="name" id="area_box"  placeholder="Площа..."> 
                                    <h2 class="title" >Орендна плата за місяць</h2>
                                    <input type="number" name="name" max="10000000" id="rent_box" placeholder="Орендна плата...">                     
                                    <select name="currency" id="currency" >
                                        <option value="$">₴</option>
                                        <option value="€">€</option>
                                        <option value="₴">$</option>
                                    </select>
                                           <h2 class="title" >Житло для біженців</h2>
                                           <select name="yes|no" id="option" >                                           
                                             <option value=1>Так</option>
                                              <option value=0>Ні</option>
                                              </select>                                                                          
             </section>
    
               
            
             
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";

const firebaseConfig = {
apiKey: "AIzaSyCPf1_9AlKYGFEF0nHn3c1IGH8BecVSeig",
authDomain: "lendory-b5d8b.firebaseapp.com",
databaseURL: "https://lendory-b5d8b-default-rtdb.firebaseio.com",
projectId: "lendory-b5d8b",
storageBucket: "lendory-b5d8b.appspot.com",
messagingSenderId: "759222136421",
appId: "1:759222136421:web:8c38d800bca06e1e6ce08c"
};

const app = initializeApp(firebaseConfig);

import {getDatabase, ref, get, set, child, update, remove}
    from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
import {getStorage, ref as sRef, uploadBytesResumable, getDownloadURL} 
    from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js";

var create  = document.getElementById("create");
function create_adv(){
    var numb = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1); //advertisement hashnumber
    var isempty = false;
    if(name_box.value == ""){isempty = true}
    if(description_box.value == ""){isempty = true}
    if(location_box.value == ""){isempty = true}
    if(floor_box.value == ""){isempty = true}
    if(rooms_box.value == ""){isempty = true}
    if(area_box.value == ""){isempty = true}
    if(rent_box.value == ""){isempty = true}

    if(!isempty){

var imgarray = [];
const storage = getStorage();

if(!files2.length==0){
    var ImgToUpload2 = files2[0];
    var ImgName2 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
    const storageRef2 = sRef(storage, "Images/"+ImgName2);
    const metaData2 = {

        contentType: ImgToUpload2.type
    } 
    const UploadTask2 = uploadBytesResumable(storageRef2, ImgToUpload2, metaData2);
    UploadTask2.on('state-changed', (snapshot)=>{

    },
    (error)=>{
        alert("error")
    },
    ()=>{
        getDownloadURL(UploadTask2.snapshot.ref).then((downloadURL)=>{
            firebase.database().ref("/").child("advertisement/" + numb + "/images/").update({
                0: downloadURL
            })
        });
    }
    );
}

if(!files3.length==0){
    var ImgToUpload3 = files3[0];
    var ImgName3 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
    const storageRef3 = sRef(storage, "Images/"+ImgName3);
    const metaData3 = {

        contentType: ImgToUpload3.type
    } 
    const UploadTask3 = uploadBytesResumable(storageRef3, ImgToUpload3, metaData3);
    UploadTask3.on('state-changed', (snapshot)=>{

    },
    (error)=>{
        alert("error")
    },
    ()=>{
        getDownloadURL(UploadTask3.snapshot.ref).then((downloadURL)=>{
            firebase.database().ref("/").child("advertisement/" + numb + "/images/").update({
                1: downloadURL
            })
        });
    }
    );
}

if(!files4.length==0){
    var ImgToUpload4 = files4[0];
    var ImgName4 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
    const storageRef4 = sRef(storage, "Images/"+ImgName2);
    const metaData4 = {

        contentType: ImgToUpload4.type
    } 
    const UploadTask4 = uploadBytesResumable(storageRef4, ImgToUpload4, metaData4);
    UploadTask4.on('state-changed', (snapshot)=>{

    },
    (error)=>{
        alert("error")
    },
    ()=>{
        getDownloadURL(UploadTask4.snapshot.ref).then((downloadURL)=>{
            firebase.database().ref("/").child("advertisement/" + numb + "/images/").update({
                2: downloadURL
            })
        });
    }
    );
}

if(!files5.length==0){
    var ImgToUpload5 = files5[0];
    var ImgName5 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
    const storageRef5 = sRef(storage, "Images/"+ImgName5);
    const metaData5 = {

        contentType: ImgToUpload5.type
    } 
    const UploadTask5 = uploadBytesResumable(storageRef5, ImgToUpload5, metaData5);
    UploadTask5.on('state-changed', (snapshot)=>{

    },
    (error)=>{
        alert("error")
    },
    ()=>{
        getDownloadURL(UploadTask5.snapshot.ref).then((downloadURL)=>{
            firebase.database().ref("/").child("advertisement/" + numb + "/images/").update({
                3: downloadURL
            })
        });
    }
    );
}
// var ImgToUpload2 = files2[0];
// var ImgToUpload3 = files3[0];
// var ImgToUpload4 = files4[0];
// var ImgToUpload5 = files5[0];


//creating images numbers
// var ImgName2 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
// var ImgName3 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
// var ImgName4 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
// var ImgName5 = Math.floor(Math.random() * (1000000000 - 1 + 1) + 1);
// imgarray.push(ImgName2, ImgName3, ImgName4, ImgName5);

//creating storage links for images

// const storageRef2 = sRef(storage, "Images/"+ImgName2); 
// const storageRef3 = sRef(storage, "Images/"+ImgName3); 
// const storageRef4 = sRef(storage, "Images/"+ImgName4); 
// const storageRef5 = sRef(storage, "Images/"+ImgName5);

//variables that contain images types
// const metaData2 = {

// contentType: ImgToUpload2.type
// }

// const metaData3 = {

// contentType: ImgToUpload3.type
// }

// const metaData4 = {

// contentType: ImgToUpload4.type
// }

// const metaData5 = {

// contentType: ImgToUpload5.type
// }

//Uploading images to storage
// const UploadTask2 = uploadBytesResumable(storageRef2, ImgToUpload2, metaData2);
// const UploadTask3 = uploadBytesResumable(storageRef3, ImgToUpload3, metaData3);
// const UploadTask4 = uploadBytesResumable(storageRef4, ImgToUpload4, metaData4);
// const UploadTask5 = uploadBytesResumable(storageRef5, ImgToUpload5, metaData5);

setdata(name_box.value, description_box.value, location_box.value, floor_box.value,
    rooms_box.value, area_box.value, rent_box.value, currency.value, option.value,  numb);

}
else{
    alert("Заповніть всі поля!");
}
}
create.onclick = create_adv;
window.onload = advert_page_loading;

</script>
</body>
</html>